WHOAT.messaging=function(e,t,n){"use strict";function r(){}var i=function(){function t(e){var t=[],i=[],s=!1,o=!1;WHOAT.networking.getToServerWithAjax("/api/v1/member/"+e,null,function(e){if(e){if(e.emails!==null||n){s=!0;for(var u=0;u<e.emails.length;u++)t.push(e.emails[u])}if(e.phones!==null||n){o=!0;for(var u=0;u<e.phones.length;u++)i.push(e.phones[u])}setTimeout(function(){r(s,o,t,i)},1)}})}function r(t,n,r,s){if(n)for(var o=0,u=s.length;o<u;o++)e(".friend_vcard").append(i(s[o].tag,s[o].label));if(t)for(var o=0,u=r.length;o<u;o++)e(".friend_vcard").append(i(r[o].tag,r[o].label));e(".friend_vcard").fadeIn()}function i(e,t){e=e||" ";t=t||" ";return"<table><tr><td>"+e+"</td><td><a href='mailto:"+t+"'>"+t+"</a></td></tr></table>"}function f(t,n,r,i){if(t==="show"){e(".inbox_details_buttons").hide();e(".inbox_details_instruction").hide();n==="accept"?e(".response_form .accepted_form").show():n==="deny"&&e(".response_form .denied_form").show();i.onfocus=function(){this.value===r&&(this.value="")};i.onblur=function(){this.value===""&&(this.value=r)}}else if(t==="hide"){n==="accept"?e(".response_form .accepted_form").hide():n==="deny"&&e(".response_form .denied_form").hide();e(".inbox_details_buttons").show();e(".inbox_details_instruction").show();i.value=r}}function l(t,n,r,i,s,o,u,a,l,c,h){f("show",n,r,t);e(".btn_cancel_message").unbind("click").bind("click",function(){f("hide",n,r,t)});e(i).unbind("submit").bind("submit",function(){if(n==="accept")var t=e("#accept_response_text").val();else if(n==="deny")var t=e("#deny_response_text").val();var r={message:t,id:s};e(o).css("cursor","auto");e(o).css("background","#ccc");e(o).text(u);e(o).attr("disabled","disabled");WHOAT.networking.postToServerWithAjax("/inbox/"+s+a,r,function(t){if(t){e(o).text(l);setTimeout(function(){if(n==="accept"){console.log(t.message);location.reload()}else n==="deny"&&(window.location="/")},1)}else t.statusText==="error"});return!1})}function c(t,n,r){WHOAT.networking.postToServerWithAjax("/inbox/"+t+r+"/friend",n,function(t){if(t.result==="success")if(r==="accept"){e(".friend_response_choices").hide();e(".friend_accepted_message").show()}else r==="deny"&&(window.location="/");else t.result==="error"})}var s=function(){var t=function(){return"/outbox"},n=function(e){return"/outbox/"+e};e(".goto_outbox").unbind("click").bind("click",function(){WHOAT.networking.redirectToURL(t())});e(".row_outbox").unbind("click").bind("click",function(){WHOAT.dashboard.sideBar.changeMenuStates(e("#intro"));var t=e(this).closest("tr"),r=t.data("message-id");WHOAT.networking.redirectToURL(n(r))});e(".delete_my_request").unbind("click").bind("click",function(){var t=e(this).closest("tr"),n=t.data("message-id"),r=e("#viewing_outbox_num").text(),i=e("#viewing_outbox_total").text(),s,o;if(r>0){s=r-1;o=i-1;e(".goto_outbox").fadeOut("fast",function(){e("#viewing_outbox_num").text(s);e("#viewing_outbox_total").text(o);e(".goto_outbox").fadeIn("fast")})}t.fadeOut("slow");WHOAT.networking.postToServerWithAjax("/outbox/"+n+"/delete",null,function(e){});return!1});var r=function(){e(".a_outbox_row").unbind("mouseover").bind("mouseover",function(){e(this).find(".trashcan").show()});e(".a_outbox_row").unbind("mouseout").bind("mouseout",function(){e(this).find(".trashcan").hide();e(this).find(".trashcan").css("left","-24px")});e(".trashcan").unbind("mouseover").bind("mouseover",function(){e(this).animate({left:"0px"},80)});e(".trashcan").unbind("mouseout").bind("mouseout",function(){e(this).find(".trashcan").css("left","-24px")})};r()},o=function(n){var r=e("#my_request_details").data("request-type");if(r==="intro")e(".open_modal").unbind("click").bind("click",function(){var t=e(this),n="member",r="contact_vcard",i=t.closest("tr").data("avatar"),s=t.closest("tr").data("member-id"),o=e.trim(i),u=e.trim(s);WHOAT.modal.wireModals().createVcardModal(n,r,u,null,null,null,null,o);WHOAT.modal.wireModals().activateCloseModal()});else if(r==="friend"){var i=e("#my_request_details").data("target-id");t(i)}e("#back_to_requests").unbind("click").bind("click",function(){window.location="/outbox"});e("#delete_this_request").unbind("click").bind("click",function(){e("#delete_this_request").css("cursor","auto");e("#delete_this_request").attr("disabled","disabled");e("#delete_this_request").text("deleting...");WHOAT.networking.postToServerWithAjax("/outbox/"+n+"/delete",null,function(e){e&&setTimeout(function(){window.location="/outbox"},1)})})},u=function(){e(".inbox_action").unbind("click").bind("click",function(){var t=e('<div data-action="delete" class="inbox_action delete_their_request" title="Delete"></div>'),n=e('<div class="inbox_td_icon_send">Sent</div>'),r=e('<div class="inbox_friend_icon_accepted">Friend</div>'),i=e(this).closest("tr"),s=e(this).data("action"),o=e(this).data("request-type"),u=e(this).closest(".center_action_group").find(".quick_accept"),a=e(this).parents(".center_action_group").find(".quick_send"),f=e(this).parents(".center_action_group").find(".quick_deny"),l=e(this).parents(".center_action_group").find(".delete_x_here"),c=e(this).closest(".center_action_group").find(".quick_btn_container"),h=i.find(".td_inbox_icon .inbox_icon_container"),p=i.find(".td_inbox_icon .inbox_icon_new"),d=i.data("message-id"),v=i.data("sender-id"),m=d,g={},y;if(s==="accept"||s==="accept_friend"){s==="accept"?y="I'd be happy to make this introduction if possible. Contact me at your convenience.":s==="accept_friend"&&(y="Hey, I would like to add you to my friend network so we can help each other out.");g={response:y,id:m};e(u).css("background-position","-246px -5px");e(u).attr("disabled","disabled");e(f).attr("disabled","disabled");WHOAT.networking.postToServerWithAjax("/inbox/"+m+"/accept",g,function(n){if(n.result==="success")e(c).fadeOut("fast",function(){e(l).append(t);e(l).fadeIn("fast");e(".delete_their_request").unbind("click").bind("click",function(){WHOAT.networking.postToServerWithAjax("/inbox/"+m+"/delete",null,function(e){i.fadeOut("fast")})})});else if(n.result==="error"){WHOAT.notify.topNotify("error",n.message);e(u).css("cursor","pointer");e(u).css("background-position","-286px -5px");e(u).removeAttr("disabled")}});return!1}if(s==="send"){message="I thought this would be a good deal for the company.";g={message:message,id:m};e(a).css("background-position","-341px -80px");e(a).attr("disabled","disabled");e(f).attr("disabled","disabled");WHOAT.networking.postToServerWithAjax("/inbox/"+m+"/accept",g,function(r){e(c).fadeOut("fast",function(){e(l).append(t);e(l).fadeIn("fast")});e(h).fadeOut("fast",function(){e(p).append(n);e(p).fadeIn("fast")})});return!1}if(s==="deny"){message="Sorry, I'm unable to help you at this time. Good luck in your search!";g={message:message,id:m};e(f).css("background-position","-327px -6px");e(f).attr("disabled","disabled");e(u).attr("disabled","disabled");WHOAT.networking.postToServerWithAjax("/inbox/"+m+"/deny",g,function(e){i.fadeOut("slow")});return!1}if(s==="delete"){WHOAT.networking.postToServerWithAjax("/inbox/"+m+"/delete",null,function(e){i.fadeOut("slow")});return!1}})},a=function(r){function s(e,t,n,r){n=n||" ";r=r||" ";return"<tr data-contact-id='"+e+"'><td data-common-label='"+t+"' data-common-title='"+n+"' data-common-company='"+r+"'><div class='vcard_gray orange open_modal'></div></td><td class='common_label small_gray_font' style='padding-left:10px;'>"+t+"</td><td class='common_label small_gray_font' style='padding-left:10px;'>"+n+"</td><td class='common_label namegame_company small_gray_font' style='padding-left:10px;'>"+r+"</td></tr>"}function o(t){for(var n=0,r=y.length;n<r;n++)e("#name_game_rows").append(s(b[n],y[n],t.contacts[n].title,t.contacts[n].company));e("#name_game_rows").fadeIn("fast");e("#name_game_rows .open_modal").unbind("click").bind("click",function(){var t=e(this),n="contact",r="contact_vcard",i=t.closest("tr").data("contact-id"),s=e.trim(i);WHOAT.modal.wireModals().createVcardModal(n,r,s);WHOAT.modal.wireModals().activateCloseModal()})}function u(){WHOAT.networking.getToServerWithAjax("/api/v1/name_game/play/"+g,null,function(e){if(e)if(e.contacts!==null||n){for(var t=0;t<e.contacts.length;t++){y.push(e.contacts[t].label);b.push(e.contacts[t].id)}o(e)}})}var i=e("#their_request_details").data("request-type");if(i==="intro"){var a,f,h,p,d,v,m,g=e("#their_request_details").data("name-game-id"),y=[],b=[];u();e(".inbox_response_btn").unbind("click").bind("click",function(){var t=e(this).closest("li").data("choice"),n,i=e(".response_form .accepted_form"),s=e(".response_form .denied_form"),o,u,a=e(".the_requesters_name").html(),f=e(".target_vcard_area .bold").html(),c=e(window),h=c.width();e(".center_details_right").css("margin-top","0px");if(t==="accept"){n="I would be happy to make this introduction if possible. Contact me at your convenience.",o=document.getElementById("accept_response_text"),u=e(".accepted_form .accept_this_request");l(o,t,n,i,r,u,"Sending...","/accept","Request Accepted",a,f)}else if(t==="deny"){n="Sorry, I am unable to help you at this time. Good luck in your search!",o=document.getElementById("deny_response_text"),u=e(".denied_form .deny_this_request");l(o,t,n,s,r,u,"Processing...","/deny","Request Denied",a,f)}});e(".block_requestor .open_modal").unbind("click").bind("click",function(){a=e(this),f="member",h="contact_vcard",p=a.closest("li").data("avatar"),d=a.closest("li").data("member-id"),v=e.trim(p),m=e.trim(d);WHOAT.modal.wireModals().createVcardModal(f,h,m,null,null,null,null,v);WHOAT.modal.wireModals().activateCloseModal()});e(".block_target .open_modal").unbind("click").bind("click",function(){a=e(this),f="contact",h="contact_vcard",d=a.closest("li").data("contact-id"),m=e.trim(d);WHOAT.modal.wireModals().createVcardModal(f,h,m);WHOAT.modal.wireModals().activateCloseModal()})}else if(i==="friend"){var w=e("#their_request_details").data("sender-id");t(w);e(".friend_response").unbind("click").bind("click",function(){var t=e(this).siblings("p").text().toLowerCase(),n=e(this),i=e(".friend_id_details").data("friend-id");if(t==="accept"){e(n).addClass("big_accept_clicked");e(n).removeClass("big_accept");e(".big_deny").attr("disabled","disabled");e(".big_deny").css("cursor","auto");e(".button_accept p").text("Accepting...");c(r,i,"/accept")}else if(t==="deny"){e(n).addClass("big_deny_clicked");e(n).removeClass("big_deny");e(".big_accept").attr("disabled","disabled");e(".big_accept").css("cursor","auto");e(".button_deny p").text("Denying...");c(r,i,"/deny")}})}e("#back_to_requests").unbind("click").bind("click",function(){window.location="/inbox"});e("#delete_this_request").unbind("click").bind("click",function(){e("#delete_this_request").css("cursor","auto");e("#delete_this_request").attr("disabled","disabled");e("#delete_this_request").text("deleting...");WHOAT.networking.postToServerWithAjax("/inbox/"+r+"/delete",null,function(e){e&&setTimeout(function(){window.location="/inbox"},1)})})};return{outboxList:s,outboxDetails:o,inboxList:u,inboxDetails:a}}();return{wire:i,init:r}}(jQuery,window);$(document).ready(function(){WHOAT.messaging.init()});